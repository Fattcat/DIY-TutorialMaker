<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #303030; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 30px auto; padding: 20px; }
        h2 { color: #2c3e50; }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .controls input, .controls select {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            flex: 1;
            min-width: 150px;
        }

        .btn {
            display: inline-block;
            padding: 10px 16px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn:hover { background: #2980b9; }

        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }

        .btn-sm { padding: 6px 12px; font-size: 12px; }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .guide-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .guide-card h5 { margin: 0 0 10px; color: #2c3e50; }
        .guide-card p { margin: 5px 0; font-size: 0.9em; color: #7f8c8d; }

        .alert { padding: 12px; background: #f1c40f; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">

    <!-- Zarovnanie: meno vƒæavo, tlaƒçidl√° vpravo -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <h2>Welcome, {{ session['username'] }}!</h2>
        </div>
        <div>
            <a href="{{ url_for('create_guide') }}" class="btn">‚ûï Create Guide</a>
            <a href="/logout" class="btn btn-danger btn-sm">Logout</a>
        </div>
    </div>

    <!-- Search & Filter -->
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Search guides..." onkeyup="filterGuides()">
        <select id="categoryFilter" onchange="filterGuides()">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat|lower }}">{{ cat }}</option>
            {% endfor %}
        </select>
        <select id="authorFilter" onchange="filterGuides()">
            <option value="">All Authors</option>
        </select>
    </div>

    <h3>All Guides</h3>

    {% if guides %}
        <div class="guide-grid" id="guideGrid">
        {% for g in guides %}
            <div class="guide-card" 
                 data-title="{{ g.title|lower }}" 
                 data-category="{{ g.category|lower }}" 
                 data-author="{{ g.author|lower }}">
                <h5>{{ g.title }}</h5>
                <p>By: <strong>{{ g.author }}</strong> | Category: <strong>{{ g.category }}</strong></p>
                <a href="{{ g.url }}" class="btn">üëÅÔ∏è View</a>
                {% if g.author == session['username'] %}
                    <a href="{{ url_for('delete_guide', filename=g.filename) }}" 
                       class="btn btn-danger btn-sm" 
                       onclick="return confirm('Delete \'{{ g.title }}\'?')">üóëÔ∏è Delete</a>
                {% endif %}
            </div>
        {% endfor %}
        </div>
    {% else %}
        <div class="alert">No guides yet. Be the first to create one!</div>
    {% endif %}
</div>

<script>
// Napln filter autorov
document.addEventListener('DOMContentLoaded', function () {
    const authorFilter = document.getElementById('authorFilter');
    const authors = new Set();

    document.querySelectorAll('.guide-card').forEach(card => {
        const author = card.dataset.author;
        if (author) {
            authors.add(author);
        }
    });

    authors.forEach(author => {
        const option = document.createElement('option');
        option.value = author;
        option.textContent = author.charAt(0).toUpperCase() + author.slice(1);
        authorFilter.appendChild(option);
    });
});

function filterGuides() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const category = document.getElementById('categoryFilter').value.toLowerCase();
    const author = document.getElementById('authorFilter').value.toLowerCase();

    document.querySelectorAll('.guide-card').forEach(card => {
        const title = card.dataset.title;
        const cat = card.dataset.category;
        const cardAuthor = card.dataset.author;

        const matchesSearch = title.includes(search);
        const matchesCategory = !category || cat === category;
        const matchesAuthor = !author || cardAuthor === author;

        card.style.display = matchesSearch && matchesCategory && matchesAuthor ? 'block' : 'none';
    });
}
</script>
</body>
</html>
